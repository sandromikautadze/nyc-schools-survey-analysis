---
title: |
  | \vspace{5cm} \LARGE Quality of NYC Schools - Survey Analysis
author: "Sandro Mikautadze"
date: "Last compiled on `r format(Sys.time(), '%d/%m/%Y')`"
output:
  pdf_document:
    number_sections: true
---

\newpage
\tableofcontents
\newpage

```{r setup, include=FALSE}
source("src/00-data-processing.r", local = knitr::knit_global())
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

This is a TLDR. Enjoy!

- Do student, teacher and parent perceptions of NYC school quality appear to be related to demographic and academic success metrics? 

- Do students, teachers, and parents have similar perceptions of NYC school quality?

# Data Cleansing

## Initial Remarks on Raw Data

In `data\raw-data` 5 files are available: **combined.csv**, **masterfile11_gened_final.txt**, **masterfile11_gened_final.xlsx**, **masterfile11_d75_final.txt** and **masterfile11_d75_final.xlsx**.

These files have been downloaed from the following links:
- https://data.cityofnewyork.us/Education/2011-NYC-School-Survey/mnz3-dyi8 [last visited July 7th, 2022]
- https://data.world/dataquest/nyc-schools-data/workspace/file?filename=combined.csv) [last visited Julty 13th, 2022]

From the *Survey-Data-Dictionary* file in `data\metadata` we can notice that **masterfile11_gened_final** and **masterfile11_d75_final** differ by a small aspect: **gened** contains information on all community schools, while **d75** from all District 75 schools, that is schools designed to teach and help students with disabilities.
As the Dictionary states, "these files display one line of information for each school, by DBN, that includes the response rate for each school, the number of surveys submitted, the size of the eligible survey population at each school, question scores, the percentage of responses selected, and the count of responses selected".

Both files come with two different formats: *.txt* and *.xlsx*. I decide to work working with *.txt*, because the Excel version requires paid software to be visualized (i.e. Microsoft Excel). Having a look at the *.txt* datasets, we can notice that they are actually saved as tsv (tab separated value) files.

The **combined** dataset has been pre-cleaned as an exercise and contains combined information on different NYC schools based on SAT, AP scores and geographical data.

## Dataset Loading and Preview

Importing the `readr` package under `tidyverse`, I will save the datasets as `combined`, `general` and `district`, respectively for **combined.csv**, **masterfile11_gened_final.txt** and **masterfile11_d75_final.txt**. 

```{r}
dim(combined)
dim(general)
dim(district)
```
Looking at the Survey Dictionary we can notice that the first columns indicate somecharacteristics of the school (we'll get into that later).
After that, there are some columns that contain aggregate data on the survey. We can identify three groups that responded to the survey:
- Students, encoded by `s`
- Teachers, encoded by `t`
- Parents, encoded by `p`

They were asked questions on 4 main categories:
- Safety and Respect, encoded by `saf`
- Communication, encoded by `com`
- Engagement, encoded by `eng`
- Academic expectations, encoded by `aca`

In addition those columns contain at the end a number: 11. We need to be aware of the fact that in the dictionary, that number is 10; so it might represent the year. 

**EXAMPLE**: `eng_p_11` indicates the engagement score collected in 2011 based on the parent responses.

After the above described columns, we have thousands of columns on the precise survey question and answers. 

As far as `combined` goes, we mainly have data on SAT scores with some other info on the different groups of people attending the school, the school's position, the class size, etc. Overall, all these pieces of information might come useful, so I decide to perform no cleaning.

## Raw Data Cleaning

Since we don't really care about the specific survey responses that are present in pretty much all columns but the initial ones, I can say that we can exclude them. Moreover, since it would be great to match performance and perception of school quality to the SAT scores, we can exclude Elementary and Middle Schools from the dataset. 

```{r}
unique(general$schooltype)
```
We are going to keep only "High School" rows.

In the d75 dataset the `schooltype` column has a unique value:
```{r}
unique(district$schooltype)
```
This value might refer to either elementary school of high school.
In this case the `studentsurveyed` column can help us, because, as written in the dictionary, "This field indicates whether or not this school serves any students in grades 6-12". The values that the column takes are the following:
```{r}
unique(district$studentssurveyed)
```
Therefore by keeping only the columns with value "Yes" we will only have high schools, which are what we are interested in.


You can find the code of the "reductions" in `src/00-data-processing.r` under the CLEANING comment.

```{r}
dim(combined_reduced)
dim(general_reduced)
dim(district_reduced)
```

Now we are dealing with a feasible number of variables and they are closer to what we really need. We can combine the data of the survey in a new dataframe, called `survey`.
```{r}
glimpse(survey)
```

## NA Values Inspection

To better clean the data we can have a look at columns with NA values. 
```{r}
colSums(is.na(combined_reduced))
colSums(is.na(survey))
```

The first thing that we can notice is that the `highschool` column in the survey dataframe has 424 NA values, out of 438 observations. This means that that column is pretty much unusable, so we will delete it. 

In addition, `combined_reduced` has `number.of.exams.with.scores.3.4.or.5` and `high_score_percent` with 328 NA values, which is more than half of the rows in the dataset. So, it is safe to safe that those columns are useless and we will delete them.

The final dimensions of the cleaned datasets are the following:
```{r}
dim(combined_reduced)
dim(survey)
```

## Joining the Datasets

Now that the necessary cleaning has been done, we can finally join `survey` and `combined_reduced` into one dataset, that we are going to be using for the analysis.

We are going to apply a `left_join` to `combined_reduced` so that we will have all values for schools of which we have SAT data. We will save it as `school_data_raw`. These are the initial dimensions:
```{r}
dim(school_data_raw)
```
We can eliminate some redundant columns, such `bn` and `schoolname`. In addition, we now know that we are dealing with high schools, so we can drop `schooltype` and `studentssurveyed`.

## Final Dataset

Therefore our final cleaned dataset, named `school_data` is the following:
```{r}
glimpse(school_data)
```
You can find the cleaned dataset in `data/clean-data/school-data.csv`.

# Data Analysis

## Recalling the Goal of the Project



